<?xml version="1.0" encoding="UTF-8" ?>
<table xmlns="http://query.yahooapis.com/v1/schema/table.xsd">
  <meta>
    <author>Tom Powers</author>
    <description>Yahoo Finance Stock Summary Information</description>
    <sampleQuery>select * from {table} where symbol="yhoo"</sampleQuery>
  </meta>
  <bindings>
    <select itemPath="" produces="XML">
      <urls>
       <url></url>
      </urls>
      <inputs>
        <key id='symbol' type='xs:string' paramType='variable' required='true' />
      </inputs>
<execute><![CDATA[
    // pad string with leading char
    String.prototype.pad = function (padchar, padlen) {
	s = this
	while (s.length < padlen) {
	    s = padchar + s;
	}
	return s;
    }
    String.prototype.trim = function () {
	var	str = this.replace(/^\s\s*/, ''),
	        ws = /\s/,
	        i = str.length;
	while (ws.test(str.charAt(--i)));
	return str.slice(0, i + 1);
    }
    // Queue the queries
    var url = "http://finance.yahoo.com/quote/" + symbol +"/profile";
    var realtimeQuery = y.query(
	"select * from html where url=@url and " + 
	"xpath='//*[@id=\"quote-header-info\"]/div[2]/div[1]/div' " +
	"limit 4",
	{url:url});
    var stock = <stock symbol={symbol}></stock>;
    var results = realtimeQuery.results;
    var elements = results.*.length(); 
    if (elements != 0) {
	stock.appendChild(<quote>{results.div.span[0].toString()}</quote>);
	stock.appendChild(<change>{results.div.span[1].toString()}</change>);
	stock.appendChild(<notice>{results.div.div.span.toString()}</notice>);
    }
    response.object = stock
]]></execute>
    </select>
  </bindings>
</table>
